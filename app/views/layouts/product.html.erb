<script>
  window.app.setCurrentAnalyticsProduct(<%= ProductAnalyticsSerializer.new(@product, scope: (current_user || {})).to_json.html_safe %>);
</script>

<%= render 'shared/navbar' %>

<!-- TODO Refactor this entire thing - @chrislloyd -->
<div style="padding-top:24px;border-bottom: 1px solid #EAEAEA;margin-bottom:24px">
  <div class="container">
    <div class="row">
      <div class="col-md-10 col-md-offset-1">
        <div class="clearfix">
          <% if controller_name == 'products' && action_name == 'show' %>
            <div class="pull-right">
              <ul class="list-inline omega pull-right">
                <% unless @product.launched? %>
                  <li>
                    <%= render 'products/launch' %>
                  </li>
                <% end %>
                <li
                    data-react-class="NotificationPreferencesDropdown"
                    data-react-props="<%= {
                      productWatchersPath: product_people_path(@product),
                      productWatchersCount: @product.watchings_count,
                      productFollowPath: product_follow_path(@product),
                      productAnnouncementsPath: product_announcements_path(@product),
                      productUnfollowPath: product_unfollow_path(@product),
                      watchingState: @product.watching_state(current_user),
                      afterFollowPath: product_people_path(@product)
                    }.to_json %>">
                </li>
              </ul>
            </div>
            <%= render @product %>
          <% else %>
            <div class="pull-right">
              <div
                  data-react-class="NotificationPreferencesDropdown"
                  data-react-props="<%= {
                    productWatchersPath: product_people_path(@product),
                    productWatchersCount: @product.watchings_count,
                    productFollowPath: product_follow_path(@product),
                    productAnnouncementsPath: product_announcements_path(@product),
                    productUnfollowPath: product_unfollow_path(@product),
                    watchingState: @product.watching_state(current_user),
                    afterFollowPath: product_people_path(@product)
                  }.to_json %>">
              </div>
            </div>
            <h3 class="pull-left alpha omega"><%= @product.name %></h3>
          <% end %>
        </div>
        <%= render 'products/sidenav', product: @product %>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <%= yield %>
    </div>
  </div>

</div>

<% unless current_user.nil? %>
  <div class="modal fade" id="edit-membership-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <form role="form" method="post" action="<%= product_person_path(@product, current_user) %>">
      <div class="modal-dialog">
        <div class="modal-content">
          <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          <input name="_method" value="patch" type="hidden">
          <div class="modal-header">
            <button type="button" class="close btn btn-sm" data-dismiss="modal">&times;</button>
            <div class="form-group" style="margin-bottom: 15px">
              <label class="control-label" for="modal-bio-editor">
                Introduce yourself, earn some <%= @product.name %> coins
              </label>
              <small class="help-block" style="margin-top: 0px">
                What skills can you contribute, how much time do you have and what are you looking to get out of the experience?
              </small>
              <textarea name="membership[bio]" id="modal-bio-editor" class="form-control bio-editor" style="min-height: 130px;"></textarea>
            </div>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="join-interests">What are you interested in?</label>
              <% interest_filters = product_membership_interests(@product, true) %>
              <div data-react-class="InterestPicker"
                  data-react-props="<%= {
                    userInterests: @current_user_interests,
                    interests: interest_filters,
                    name: 'membership[interests][]'
                  }.to_json %>">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary btn-block" id="join-intro-button">Update</button>
          </div>

        </div>
      </div>
    </form>
  </div>
<% end %>

<%= render 'shared/footer' %>

<% parent_layout 'application' %>

<script>
  $('#edit-membership-modal').on('shown.bs.modal', function() {
    $('#modal-bio-editor').attr('placeholder', app.defaultBio());
  });
</script>
