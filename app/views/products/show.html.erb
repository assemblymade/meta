<% title @product.name, @product.pitch %>
<% activate_nav! :idea %>
<%= track 'product.viewed', ProductAnalyticsSerializer.new(@product, scope: current_user) %>

<div class="row">
  <div class="col-md-7">
    <% if @product.you_tube_video_url? %>
      <div class="embed-responsive embed-responsive-16by9">
        <iframe
          class="embed-responsive-item"
          width="853"
          height="480"
          src="<%= @product.video_embed_url %>"
          frameborder="0"
          allowfullscreen
        ></iframe>
      </div>
      <hr>
    <% end %>

    <div class="markdown markdown-normalized text-large">
      <% if @product.lead.present? || @product.description.present? || (@product.info || {}).any? %>
        <% if @product.lead.present? %>
          <div class="lead">
            <%= product_markdown(@product, @product.lead) %>
          </div>
        <% end %>

        <%== @product.description_html %>

        <% (@product.info || {}).each do |field, value| %>
          <% if value.present? %>
            <h2><%= field.titlecase %></h2>
            <%== markdown(value) %>
          <% end %>
        <% end %>
      <% else %>
        <% if @product.user == current_user %>
          <p class="lead text-center">
            This space reserved for a kick ass description.
          </p>
          <p class="text-center">
            <a href="<%= edit_product_path(@product) %>">Update your idea</a>
          </p>
        <% else %>
          <p class="lead text-center">
            Looks like <%= @product.name %> is just getting started! Check back later and there should be some more details
          </p>
        <% end %>
      <% end %>
    </div>

  </div>

  <div class="col-md-4 col-md-offset-1">

    <% if signed_in? %>

      <% product_membership = current_user.team_memberships.find_by(product: @product) %>

      <a href="<%= product_people_path(@product) %>" class="btn btn-lg btn-success btn-block">Build this product with us</a>

      <div class="modal fade" id="intro-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <form role="form" method="post" action="<%= product_person_path(@product, current_user) %>">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Want to be part of <%= @product.name %>? Introduce yourself!</h4>
              </div>
              <div class="modal-body">
                <p>
                  What skills can you contribute, how much time do you have, and what are you looking to get out of the experience?
                </p>

                <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
                <input name="_method" value="patch" type="hidden">

                <div class="form-group">
                  <textarea name="membership[bio]" id="bio-editor" class="form-control bio-editor" rows="4" id="self-introduction" placeholder="Hi everyone, I'm Maeby! I love coding in VB6, and I develop apps for IE7 and Windows ME. When I'm not hacking, I like to dabble in design: gradients and 3D effects are my jam! I'm excited to dive in and get to know you all!"></textarea>
                </div>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Introduce yourself</button>
              </div>

            </form>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->

    <% else %>
      <a href="<%= product_tasks_path(@product) %>" class="btn btn-lg btn-success btn-block">Build this product with us</a>
    <% end %>



    <br>


    <div class="stat-group">
      <div class="stat">
        <div class="stat-value"><%= @product.posts.count %></div>
        <div class="stat-title"><%= "Update".pluralize(@product.posts.count) %></div>
      </div>

      <div class="stat">
        <div class="stat-value"><%= @product.tasks.open.count %></div>
        <div class="stat-title"><%= "Bounty".pluralize(@product.tasks.open.count) %></div>
      </div>

      <div class="stat">
        <div class="stat-value"><%= @product.partners_count %></div>
        <div class="stat-title"><%= "Partner".pluralize(@product.partners_count) %></div>
      </div>
    </div>

    <% if @product.team_building? %>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h6 class="panel-title">Team Building</h6>
        </div>
        <div class="panel-body">
          <p>
            This product is growing a team. It needs to reach <strong>10 team members</strong> in
            <strong>30 days</strong> before it is Greenlit. You can become a team member by
            <a href="<%= product_people_path(@product) %>">introducing yourself</a>.</p>

          <div class="progress progress-sm" style="margin-bottom:6px">
            <div class="progress-bar progress-bar-success" style="width:<%= (((@product.bio_memberships_count || 0) / 10.0) * 100).round %>%"></div>
          </div>

          <div class="clearfix">
            <div class="pull-left"><%= pluralize(@product.bio_memberships_count, 'team member') %></div>
            <div class="pull-right"><%= pluralize(@product.team_building_days_left, 'day') %> left</div>
          </div>

        </div>
      </div>
    <% end %>

    <h6 class="text-muted">Core Team</h6>

    <div class="list-group list-group-breakout">
      <% @product.core_team.each do |user| %>
        <a class="list-group-item" href="<%= user_path(user) %>">
          <div class="chip chip-sm">
            <span class="chip-icon"><%= avatar_tag(user) %></span>
            <span class="text-primary"><%= user.username %></span>
            <% if user.bio.present? %>
              &mdash;
              <span class="text-muted"><%= user.bio %></span>
            <% end %>
          </div>
        </a>
      <% end %>
    </div>

    <h6 class="text-muted">Other links</h6>
    <ul class="list-unstyled large omega">
      <% if @product.homepage_url.present? %>
        <li><a href="<%= @product.homepage_url %>" target="_blank"><%= @product.homepage_url %></a></li>
      <% end %>

      <% if @product.chat_rooms.any? %>
        <% chat_room = @product.chat_rooms.first %>
        <li><a href="<%= chat_room_path(chat_room) %>">Chat</a></li>
      <% end %>

      <li><a href="<%= product_projects_path(@product) %>">Projects</a></li>
      <li><a href="<%= product_discussions_path(@product) %>">Discussions</a></li>
      <li><a href="<%= product_assets_path(@product) %>">Assets</a></li>
      <li><a href="<%= product_repos_path(@product) %>">Repositories</a></li>
    </ul>

    <% if current_user && @product.core_team?(current_user) %>
      <h6 class="text-muted">Product Authentication Token</h6>

      <div class="list-group list-group-breakout well">
        <p class="text-muted">
          Keep this token safe. Only the core team has access to it, and it's needed to set up payments. See <a href="<%= product_path('payments') %>">Assembly Payments</a> for more info.
        </p>
        <strong><%= @product.authentication_token %></strong>
      </div>

    <% end %>

  </div>


</div>
