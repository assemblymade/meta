<% title "Tasks", @product.name %>

<%= render 'shared/navbar' %>
<%= render 'products/navbar' %>

<div class="page">
  <div class="container">

    <div class="page-header">
      <div class="pull-right">
        <a class="btn btn-success" href="<%= new_product_wip_path(@product) %>">Create a Bounty</a>
      </div>


      <h2 class="page-header-title"><%= @product.reward %>
        <small>
          &mdash;
          <%= format_coins(@product, @product.real_bounty_value) %>
          to be earned from
          <strong><%= pluralize @product.tasks.open.count, 'bounty' %></strong>
        </small>
      </h2>
    </div>

    <div class="row">
      <% if @product.wips.any? %>
        <div class="col-md-8 col-xs-8">

          <ol class="list-group list-group-breakout list-group-padded" id="wips-view-el">
            <% @wips.each do |task| %>
              <li class="list-group-item">
                <%= render 'summary', task: task %>
              </li>
            <% end %>
          </ol>

          <hr>

          <%= paginate @wips, theme: 'twitter-bootstrap-3' %>
        </div>

        <div class="col-md-3 col-xs-3 col-md-offset-1 col-xs-offset-1">
          <div class="panel panel-default">
            <%= render partial: 'tasks/filters' %>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">
              <h6 class="panel-title">Notifications</h6>
            </div>
            <div class="panel-body small">
              <% if signed_in? && @product.watching?(current_user) %>
                <a class="btn btn-default btn-block btn-sm" href="<%= unsubscribe_product_path(@product) %>" data-method="post">
                  <span class="glyphicon glyphicon-volume-off"></span>
                  Unwatch
                </a>
                <br>
                <p class="omega">You are notified of new bounties.</p>
              <% else %>
                <a class="btn btn-default btn-block btn-sm" href="<%= subscribe_product_path(@product) %>" data-method="post">
                  <span class="glyphicon glyphicon-eye-open"></span>
                  Watch
                </a>
                <br>
                <p class="omega">You'll be notified of new bounties.</p>
              <% end %>
            </div>
          </div>
        </div>

      <% else %>
        <div class="col-md-6 col-xs-6 col-md-offset-3">
          <div class="well well-lg omega">
            <h3 class="alpha"><strong>Create the first task</strong></h3>
            <p class="text-muted omega">
              Get started by breaking down a new idea into bite-sized chunks
              that can upvoted on and prioritized. Writing a great description will
              make it super easy for anyone to jump in and get to work.
            </p>
          </div>
        </div>
      <% end %>
    </div><!-- .row -->
  </div>
</div>

<%= render 'shared/footer' %>

<% unless staff? %>
  <script>
    analytics.track('product.wips.viewed', <%== ProductAnalyticsSerializer.new(@product).to_json %>)
  </script>
<% end %>
